import{x as K,r as d,l as G,o as H,m as J,b as h,c as m,d as p,e as t,f as s,g as r,i as y,t as u,n as U,k as v}from"./index-96009e84.js";import{a as V}from"./axios-9cbf0d09.js";const Q={class:"grid"},W={class:"col-12"},X={class:"card"},Y={class:"my-2"},Z={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ee=t("h5",{class:"m-0"},"Manage Users",-1),le={class:"block mt-2 md:mt-0 p-input-icon-left"},oe=t("i",{class:"pi pi-search"},null,-1),ae=t("span",{class:"p-column-title"},"ID",-1),se=t("span",{class:"p-column-title"},"Nom",-1),te=t("span",{class:"p-column-title"},"Prénom",-1),re=t("span",{class:"p-column-title"},"Email",-1),ie=t("span",{class:"p-column-title"},"Role",-1),ne={class:"field"},de=t("label",{for:"nom"},"Nom",-1),ue={key:0,class:"p-invalid"},ce={key:1,class:"p-invalid"},me={class:"field"},pe=t("label",{for:"prenom"},"Prénom",-1),ve={key:0,class:"p-invalid"},_e={key:1,class:"p-invalid"},fe={class:"field"},he=t("label",{for:"email"},"Email",-1),ye={key:0,class:"p-invalid"},be={key:1,class:"p-invalid"},ge={class:"field"},we=t("label",{for:"role"},"Role",-1),ke={key:0,class:"p-error"},Ue={key:1,class:"p-invalid"},Ve={class:"flex justify-content-end mt-3"},Ce=t("span",null,"Are you sure you want to delete the selected users?",-1),Se={__name:"User",setup(De){const _=K(),S=d(null),C=d([]),b=d(!1),D=d(!1),x=d(!1),e=d({}),g=d(null),E=d(null),w=d({}),n=d(!1),i=d({});G(()=>{A()}),H(()=>{N(),R()});const N=async()=>{try{const a=await V.get("http://127.0.0.1:8000/api/users");S.value=a.data}catch(a){console.error("Error fetching users:",a),_.add({severity:"error",summary:"Error",detail:"Failed to fetch users",life:3e3})}},R=async()=>{try{const a=await V.get("http://127.0.0.1:8000/api/roles");C.value=a.data.map(l=>({id:l.id,name:l.name})),console.log("Fetched roles:",C.value)}catch(a){console.error("Error fetching roles:",a),_.add({severity:"error",summary:"Error",detail:"Failed to fetch roles",life:3e3})}},T=()=>{e.value={nom:"",prenom:"",email:"",role_id:null},i.value={},n.value=!1,b.value=!0},F=()=>{b.value=!1,n.value=!1},M=async()=>{if(n.value=!0,!e.value.nom||!e.value.prenom||!e.value.email||!e.value.role_id){_.add({severity:"error",summary:"Error",detail:"Please fill all required fields",life:3e3});return}try{let a;const l={nom:e.value.nom,prenom:e.value.prenom,email:e.value.email,password:"passer123",role_id:e.value.role_id};console.log("User data before sending:",e.value),console.log("User data being sent:",l),e.value.id?(console.log("Updating user:",l),a=await V.put(`http://127.0.0.1:8000/api/users/${e.value.id}`,l)):(console.log("Creating new user:",l),a=await V.post("http://127.0.0.1:8000/api/users",l)),console.log("API Response:",a.data),a.data?(_.add({severity:"success",summary:"Successful",detail:e.value.id?"User Updated":"User Created",life:3e3}),b.value=!1,e.value={},i.value={},await N()):_.add({severity:"error",summary:"Error",detail:"Failed to save user",life:3e3})}catch(a){if(console.error("Error saving user:",a),a.response&&a.response.data&&a.response.data.errors){i.value=a.response.data.errors,console.log("Validation errors:",a.response.data.errors);let l="Validation errors:";for(let c in a.response.data.errors)l+=`
${c}: ${a.response.data.errors[c].join(", ")}`;_.add({severity:"error",summary:"Validation Error",detail:l,life:5e3})}else _.add({severity:"error",summary:"Error",detail:"Failed to save user: "+(a.message||"Unknown error"),life:3e3})}},L=a=>{e.value={...a},i.value={},b.value=!0},B=a=>{e.value=a,D.value=!0},I=()=>{E.value.exportCSV()},q=()=>{x.value=!0},A=()=>{w.value={global:{value:null,matchMode:J.CONTAINS}}};return(a,l)=>{const c=h("Button"),$=h("Toolbar"),k=h("InputText"),f=h("Column"),j=h("DataTable"),O=h("Dropdown"),P=h("Dialog");return m(),p("div",Q,[t("div",W,[t("div",X,[s($,{class:"mb-4"},{start:r(()=>[t("div",Y,[s(c,{label:"New",icon:"pi pi-plus",class:"mr-2",severity:"success",onClick:T}),s(c,{label:"Delete",icon:"pi pi-trash",severity:"danger",onClick:q,disabled:!g.value||!g.value.length},null,8,["disabled"])])]),end:r(()=>[s(c,{label:"Export",icon:"pi pi-upload",severity:"help",onClick:l[0]||(l[0]=o=>I(o))})]),_:1}),s(j,{ref_key:"dt",ref:E,value:S.value,selection:g.value,"onUpdate:selection":l[2]||(l[2]=o=>g.value=o),dataKey:"id",paginator:!0,rows:10,filters:w.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} users"},{header:r(()=>[t("div",Z,[ee,t("span",le,[oe,s(k,{modelValue:w.value.global.value,"onUpdate:modelValue":l[1]||(l[1]=o=>w.value.global.value=o),placeholder:"Search..."},null,8,["modelValue"])])])]),default:r(()=>[s(f,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(f,{field:"id",header:"ID",sortable:!0,headerStyle:"width:10%; min-width:8rem;"},{body:r(o=>[ae,y(" "+u(o.data.id),1)]),_:1}),s(f,{field:"nom",header:"Nom",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:r(o=>[se,y(" "+u(o.data.nom),1)]),_:1}),s(f,{field:"prenom",header:"Prénom",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:r(o=>[te,y(" "+u(o.data.prenom),1)]),_:1}),s(f,{field:"email",header:"Email",sortable:!0,headerStyle:"width:25%; min-width:10rem;"},{body:r(o=>[re,y(" "+u(o.data.email),1)]),_:1}),s(f,{field:"role_id",header:"Role",sortable:!0,headerStyle:"width:15%; min-width:8rem;"},{body:r(o=>[ie,y(" "+u(o.data.role_id),1)]),_:1}),s(f,{header:"Actions",headerStyle:"width: 10rem"},{body:r(o=>[s(c,{icon:"pi pi-pencil",onClick:z=>L(o.data)},null,8,["onClick"]),s(c,{icon:"pi pi-trash",onClick:z=>B(o.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),s(P,{visible:b.value,"onUpdate:visible":l[7]||(l[7]=o=>b.value=o),style:{width:"450px"},header:"User Details",modal:"",class:"p-fluid"},{default:r(()=>[t("div",ne,[de,s(k,{id:"nom",modelValue:e.value.nom,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.nom=o),class:U({"p-invalid":n.value&&!e.value.nom})},null,8,["modelValue","class"]),n.value&&!e.value.nom?(m(),p("small",ue,"Nom is required.")):v("",!0),i.value.nom?(m(),p("small",ce,u(i.value.nom[0]),1)):v("",!0)]),t("div",me,[pe,s(k,{id:"prenom",modelValue:e.value.prenom,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.prenom=o),class:U({"p-invalid":n.value&&!e.value.prenom})},null,8,["modelValue","class"]),n.value&&!e.value.prenom?(m(),p("small",ve,"Prénom is required.")):v("",!0),i.value.prenom?(m(),p("small",_e,u(i.value.prenom[0]),1)):v("",!0)]),t("div",fe,[he,s(k,{id:"email",modelValue:e.value.email,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.email=o),class:U({"p-invalid":n.value&&!e.value.email})},null,8,["modelValue","class"]),n.value&&!e.value.email?(m(),p("small",ye,"Email is required.")):v("",!0),i.value.email?(m(),p("small",be,u(i.value.email[0]),1)):v("",!0)]),t("div",ge,[we,s(O,{id:"role",modelValue:e.value.role_id,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.role_id=o),options:C.value,optionLabel:"name",optionValue:"id",placeholder:"Select a Role",class:U({"p-invalid":n.value&&!e.value.role_id})},null,8,["modelValue","options","class"]),n.value&&!e.value.role_id?(m(),p("small",ke,"Role is required.")):v("",!0),i.value.role_id?(m(),p("small",Ue,u(i.value.role_id[0]),1)):v("",!0)]),t("div",Ve,[s(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:F}),s(c,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:M})])]),_:1},8,["visible"]),s(P,{visible:D.value,"onUpdate:visible":l[8]||(l[8]=o=>D.value=o),style:{width:"450px"},header:"Confirm",modal:"",footer:a.deleteUserDialogFooter,class:"p-fluid"},{default:r(()=>[t("span",null,[y("Are you sure you want to delete "),t("b",null,u(e.value.nom)+" "+u(e.value.prenom),1),y("?")])]),_:1},8,["visible","footer"]),s(P,{visible:x.value,"onUpdate:visible":l[9]||(l[9]=o=>x.value=o),style:{width:"450px"},header:"Confirm",modal:"",footer:a.deleteUsersDialogFooter,class:"p-fluid"},{default:r(()=>[Ce]),_:1},8,["visible","footer"])])])])}}};export{Se as default};
